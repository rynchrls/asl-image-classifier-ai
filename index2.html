<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>ASL Image Upload → Word Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/forms"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  </head>
  <body class="bg-gray-100 min-h-screen flex items-center justify-center p-6">
    <div class="bg-white shadow-xl rounded-2xl p-6 w-full max-w-6xl space-y-8">
      <h2 class="text-2xl font-bold text-center text-gray-800">
        🔤 ASL Image Upload → Word Builder
      </h2>

      <!-- Controls -->
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <input
          id="fileInput"
          type="file"
          accept="image/*"
          multiple
          class="flex-1 block text-sm text-gray-700 border border-gray-300 rounded-lg cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500"
        />

        <div class="flex gap-3 justify-center">
          <button
            id="uploadBulk"
            class="px-5 py-2 bg-green-600 text-white font-semibold rounded-lg shadow hover:bg-green-700 transition"
          >
            Upload All Images 📂
          </button>
          <button
            id="clearImages"
            class="px-5 py-2 bg-yellow-500 text-white font-semibold rounded-lg shadow hover:bg-yellow-600 transition"
          >
            Clear Images 🗑️
          </button>
          <button
            id="clearWord"
            class="px-5 py-2 bg-red-500 text-white font-semibold rounded-lg shadow hover:bg-red-600 transition"
          >
            Clear Word ❌
          </button>
        </div>
      </div>

      <!-- Previews -->
      <div>
        <h3 class="text-lg font-semibold text-gray-700 mb-3">🖼️ Previews</h3>
        <div
          id="previewContainer"
          class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4"
        ></div>
      </div>

      <!-- Word builder -->
      <div class="bg-gray-50 p-6 rounded-xl shadow-inner">
        <h3 class="text-lg font-semibold text-gray-700 mb-4 text-center">
          ✨ Word Builder
        </h3>
        <div
          id="wordContainer"
          class="flex flex-wrap gap-3 justify-center text-4xl font-bold text-gray-900"
        ></div>
      </div>
    </div>

    <script>
      const fileInput = document.getElementById("fileInput");
      const uploadBulkBtn = document.getElementById("uploadBulk");
      const clearImagesBtn = document.getElementById("clearImages");
      const clearWordBtn = document.getElementById("clearWord");
      const previewContainer = document.getElementById("previewContainer");
      const wordContainer = document.getElementById("wordContainer");

      // Show previews when files are selected
      fileInput.addEventListener("change", () => {
        previewContainer.innerHTML = "";
        Array.from(fileInput.files).forEach((file, index) => {
          const reader = new FileReader();
          reader.onload = (e) => {
            const div = document.createElement("div");
            div.className =
              "border rounded-lg p-2 flex flex-col items-center text-sm bg-gray-50";
            div.innerHTML = `
              <img src="${e.target.result}" 
                   class="w-full h-32 object-contain rounded-md mb-2 bg-gray-100" />
              <span id="status-${index}" class="text-gray-500 text-xs">⏳ Pending</span>
            `;
            previewContainer.appendChild(div);
          };
          reader.readAsDataURL(file);
        });
      });

      // Upload all images (preserve order)
      uploadBulkBtn.addEventListener("click", async () => {
        const files = Array.from(fileInput.files);
        if (files.length === 0) {
          alert("⚠️ Please select at least one image!");
          return;
        }

        const promises = files.map((file, index) =>
          uploadImageAndReturnLetter(file, index)
        );
        const results = await Promise.all(promises);

        results.forEach((letter) => {
          if (letter) addLetterToWord(letter);
        });
      });

      // Clear previews
      clearImagesBtn.addEventListener("click", () => {
        previewContainer.innerHTML = "";
        fileInput.value = "";
      });

      // Upload helper
      async function uploadImageAndReturnLetter(file, index) {
        const statusEl = document.getElementById(`status-${index}`);
        if (statusEl) statusEl.textContent = "⏳ Detecting...";

        const formData = new FormData();
        formData.append("file", file);

        try {
          const response = await fetch("http://localhost:5000/asl", {
            method: "POST",
            body: formData,
          });

          const result = await response.json();
          console.log(`Response for image ${index + 1}:`, result);

          if (result.letter) {
            if (statusEl) statusEl.textContent = `✅ ${result.letter}`;
            return result.letter;
          } else {
            if (statusEl)
              statusEl.textContent =
                "❌ " + (result.message || "No letter detected");
            return null;
          }
        } catch (err) {
          console.error("Error uploading image:", err);
          if (statusEl) statusEl.textContent = "🚨 Server error";
          return null;
        }
      }

      // Word builder
      function addLetterToWord(letter) {
        const span = document.createElement("span");
        span.textContent = letter;
        span.className = "opacity-0 transform scale-50";
        wordContainer.appendChild(span);

        gsap.to(span, {
          opacity: 1,
          scale: 1,
          duration: 0.5,
          ease: "back.out(1.7)",
        });
      }

      // Clear word
      clearWordBtn.addEventListener("click", () => {
        wordContainer.innerHTML = "";
      });
    </script>
  </body>
</html>



